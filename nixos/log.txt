# Preparation

nmtui
mkdir -p ~/repos/personal
cd ~/repos/personal
nix-shell -p git
git clone git@github.com:jpsecher/os-setup.git
cd os-setup
export HOST=knuth
mkdir nixos/machines/$HOST
cp /etc/nixos/* nixos/machine/$HOST/
git add .
git commit -m "Autogenerated config for $HOST"

# To use home-manager:
sudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-23.05.tar.gz home-manager
sudo nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixos-unstable
sudo nix-channel --update
export HOST=knuth
export USER=jps
export REPO=~/repos/personal/os-setup
sudo cp $REPO/nixos/machines/$HOST/configuration /etc/nixos/configuration/nix
sudo ln -s $REPO/nixos/users/$USER/home.nix /etc/nixos/home-$USER.nix

# Google drive
mkdir ~/gdrive-personal
# First create an OAuth secret (https://console.developers.google.com/auth/clients)
# or use an existing one.  Copy the id and secret to initialise the local configuration:
google-drive-ocamlfuse -id ... -secret ... -label personal ~/gdrive-personal
secret: GOCSPX-xxxxxxxxxxxxxxxxxxxxxxxxxx4A
id: 679yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy.apps.googleusercontent.com
# If not working, add -debug and dig out the URL

# To make Gnome respect xkbOptions:
gsettings reset org.gnome.desktop.input-sources xkb-options
gsettings reset org.gnome.desktop.input-sources sources

# To use devenv:
nix-channel --add https://github.com/cachix/devenv/latest devenv

# To use rustup (add rustup to packages, and then):
rustup default stable
rustup component add rust-analyzer
